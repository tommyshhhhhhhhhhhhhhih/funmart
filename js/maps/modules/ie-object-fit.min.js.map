{"version":3,"sources":["src/js/modules/ie-object-fit.mjs"],"names":["$","window","document","ua","navigator","userAgent","browser","isChrome","test","isFirefox","isSafari","isIE","isEdge","currentItem","objectFitForIE_getBg","thisItemJS","width","height","resultGCD","canvas","src","dataset","item","countMath","A","B","GCD","isNaN","fgcd","x","y","parseInt","hasClass","itemW","naturalWidth","itemH","naturalHeight","imgEmpty","createElement","toDataURL","attr","css","background-repeat","background-position","background-image","addClass","undefined","each","this","jQuery"],"mappings":"0BAGE,SAAWA,EAAGC,EAAQC,GAMvB,IAAIC,EAAKC,UAAUC,UACfC,EAAU,CACbC,SAAU,UAAUC,KAAKL,GACzBM,UAAW,WAAWD,KAAKL,GAC3BO,SAAU,UAAUF,KAAKL,GAGzBQ,KAAM,QAAQH,KAAKL,IAAO,WAAWK,KAAKL,GAC1CS,OAAQ,QAAQJ,KAAKL,IAGlBG,EAAQC,WAAUD,EAAQI,UAAW,GACrCJ,EAAQM,SACXN,EAAQC,UAAW,EACnBD,EAAQI,UAAW,GAMpB,IAuE+BG,EAtE3BC,EAAuB,SAAUC,GAEpC,IA4BsBC,EAAOC,EAIxBC,EAGAC,EAnCDC,EAAML,EAAWM,QAAQD,KAAOL,EAAWK,IAC3CE,EAAOtB,EAAEe,GAUb,SAASQ,EAAUC,EAAGC,GACrB,IAAIC,EAYJ,MAVS,IAALF,GAAgB,IAALC,GAAgB,KAALD,GAAiB,KAALC,GAAYE,MAAMH,IAAMG,MAAMF,KAGnEC,EATF,SAASE,EAAKC,EAAGC,GAChB,OAAY,GAALA,EAASD,EAAID,EAAKE,EAAGD,EAAIC,GAQzBF,CAAKG,SAASP,GAAIO,SAASN,KAMrB,CAACC,EAJH,KAAPA,EACIF,EAAIC,EAAKC,EAEV,OAyBR,GA3CIJ,EAAKU,SAPM,UAOeZ,EAAM,KA2C/BE,EAAKU,SAAS,WAAY,CAG9B,IAAIC,EAAQlB,EAAWmB,aACnBC,EAAQpB,EAAWqB,cAInBC,GAvBAnB,EAAYK,EAHhBP,EAAkB,IADGA,EA2BOiB,GA1BL,EAAIjB,EAC3BC,EAAoB,IAFQA,EA2BOkB,GAzBV,EAAIlB,GAEY,IAGrCE,EAASjB,EAASoC,cAAc,WAG7BtB,MAAQA,EAAQE,EACvBC,EAAOF,OAASA,EAASC,EAGfC,EAAOoB,aAgBjBjB,EAAKkB,KAAK,MAAOH,GACjBf,EAAKmB,IAAI,CACRC,oBAAqB,YACrBC,sBAAuB,UACvBC,mBAAoB,OAASxB,EAAM,MAGpCE,EAAKuB,SAAS,aAIXvC,EAAQK,OACQmC,MAAfjC,GACHb,EAAE,qBAAqB+C,KAAK,WAC3BjC,EAAqBkC,QAEtBhD,EAAE,6BAA6B+C,KAAK,WACnCjC,EAAqBkC,SAGtBlC,EAAqBD,IA3GvB,CAiHCoC,OAAQhD,OAAQC","file":"../../modules/ie-object-fit.min.js","sourcesContent":["// -----------------------------------\r\n// Object-fit for IE/Edge (配合Lazy Load)\r\n// -----------------------------------\r\n; (function ($, window, document) {\r\n\r\n\t// -----------------------------------\r\n\t// Setting\r\n\t// -----------------------------------\r\n\t// 判斷browser Begin\r\n\tvar ua = navigator.userAgent;\r\n\tvar browser = {\r\n\t\tisChrome: /chrome/i.test(ua),\r\n\t\tisFirefox: /firefox/i.test(ua),\r\n\t\tisSafari: /safari/i.test(ua),\r\n\r\n\t\t// https://msdn.microsoft.com/en-us/library/ms537503(v=vs.85).aspx\r\n\t\tisIE: /msie/i.test(ua) || /trident/i.test(ua),\r\n\t\tisEdge: /edge/i.test(ua)\r\n\t};\r\n\t// 修正數值browser\r\n\tif (browser.isChrome) browser.isSafari = false;\r\n\tif (browser.isEdge) {\r\n\t\tbrowser.isChrome = false;\r\n\t\tbrowser.isSafari = false;\r\n\t}\r\n\r\n\r\n\t// Object-fit Start--------------------------------------------------\r\n\t// 取得 & 替換 \r\n\tvar lazyClass = 'lazy'; // 配合Lazy load => 如果是Lazy load 圖片不動作\r\n\tvar objectFitForIE_getBg = function (thisItemJS) {\r\n\r\n\t\tvar src = thisItemJS.dataset.src || thisItemJS.src;\r\n\t\tvar item = $(thisItemJS);\r\n\r\n\t\t// If element has lazy load class\r\n\t\tif (item.hasClass(lazyClass)) src = \"\";\r\n\r\n\t\t// 計算最大公因數/最小公倍數\r\n\t\t// Reference https://www.liveism.com/math-live/arithmetic/live-online-gcd-lcm-calculator.php\r\n\t\tfunction fgcd(x, y) {\r\n\t\t\treturn y == 0 ? x : fgcd(y, x % y);\r\n\t\t}\r\n\t\tfunction countMath(A, B) {\r\n\t\t\tvar GCD; // greatest common divisor 最大公因數 \r\n\t\t\tvar LCM; // least common multiple 最小公倍數 \r\n\t\t\tif (A == \"\" || B == \"\" || A == \"0\" || B == \"0\" || isNaN(A) || isNaN(B)) {\r\n\t\t\t\t// console.log(\"請輸入欲求最大公因數的兩個正整數！\");\r\n\t\t\t} else {\r\n\t\t\t\tGCD = fgcd(parseInt(A), parseInt(B));\r\n\t\t\t}\r\n\t\t\tif (GCD != \"0\")\r\n\t\t\t\tLCM = (A * B) / GCD;\r\n\t\t\telse\r\n\t\t\t\tLCM = \"無意義\";\r\n\t\t\tvar result = [GCD, LCM];\r\n\t\t\treturn result\r\n\t\t}\r\n\r\n\t\t// 取得空PNG\r\n\t\tfunction getBase64Png(width, height) {\r\n\t\t\twidth = (width == 0) ? 1 : width;\r\n\t\t\theight = (height == 0) ? 1 : height;\r\n\r\n\t\t\tvar resultGCD = countMath(width, height)[0];\r\n\r\n\t\t\t// Create transparent image\r\n\t\t\tvar canvas = document.createElement(\"canvas\");\r\n\r\n\t\t\t// set desired size of transparent image\r\n\t\t\tcanvas.width = width / resultGCD;\r\n\t\t\tcanvas.height = height / resultGCD;\r\n\r\n\t\t\t// extract as new image (data-uri)\r\n\t\t\tvar url = canvas.toDataURL();\t// 預設會轉成 image/png\r\n\t\t\treturn url\r\n\t\t}\r\n\r\n\t\t// console.log(item.css('-o-object-fit')) // IE 無法找到object-fit\r\n\t\tif (!item.hasClass('ie-hack')) {\r\n\r\n\t\t\t// Get image width & height\r\n\t\t\tvar itemW = thisItemJS.naturalWidth;\r\n\t\t\tvar itemH = thisItemJS.naturalHeight;\r\n\r\n\t\t\t// 用svg產生空的比例\r\n\t\t\t// var imgEmpty = 'data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"'+ itemW +'\" height=\"'+ itemH +'\"><path fill=\"none\" d=\"M0 0h'+ itemW +'v'+ itemH +'H0z\"/></svg>'\r\n\t\t\tvar imgEmpty = getBase64Png(itemW, itemH);\r\n\r\n\t\t\t// 替換成背景圖片\r\n\t\t\titem.attr('src', imgEmpty)\r\n\t\t\titem.css({\r\n\t\t\t\t'background-repeat': 'no-repeat',\r\n\t\t\t\t'background-position': '50% 50%',\r\n\t\t\t\t'background-image': 'url(' + src + ')',\r\n\t\t\t\t// 'background-size': 'cover',\r\n\t\t\t});\r\n\t\t\titem.addClass('ie-hack');\r\n\t\t}\r\n\t};\r\n\tvar objectFitForIE = function (currentItem) {\r\n\t\tif (browser.isIE) {\r\n\t\t\tif (currentItem == undefined) {\r\n\t\t\t\t$('.object-fit > img').each(function () {\r\n\t\t\t\t\tobjectFitForIE_getBg(this)\r\n\t\t\t\t});\r\n\t\t\t\t$('.object-fit-contain > img').each(function () {\r\n\t\t\t\t\tobjectFitForIE_getBg(this)\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tobjectFitForIE_getBg(currentItem);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tobjectFitForIE();\r\n\r\n})(jQuery, window, document);\r\n"],"sourceRoot":"../../../src/"}