{"version":3,"sources":["src/js/modules/lazyload.mjs"],"names":["window","document","ua","navigator","userAgent","browser","isChrome","test","isFirefox","isSafari","isIE","isEdge","lazy","func","wait","mustRun","timeout","startTime","lazyLoad_throttle","lazyLoad","Date","args","arguments","curTime","undefined","requestTimeout","clearRequestTimeout","clearTimeout","apply","this","setTimeout","scrollLazy","lazyScrollWarapper","querySelectorAll","k","length","registerListener","setLazy","scrollBind","viewmoreButton","lazyClass","lazyAttr","lazyAttrBg","lazyCssOnly","lazyloadedClass","lazyloadedClass_wrapper","pageReady","objectFitClass","objectFitClassContain","registerScroll","getElementsByClassName","querySelector","onclick","i","el","rect","getBoundingClientRect","width","height","bottom","right","top","innerHeight","documentElement","clientHeight","left","innerWidth","clientWidth","currentLazyEl","classList","contains","add","parentElement","lazyImg","getAttribute","lazyBg","imgSrc","isBg","tagName","toUpperCase","style","backgroundImage","src","removeAttribute","onload","_thisParent","_thisLoader","remove","complete","Array","prototype","filter","call","l","removeListener","event","target","tg","addEventListener","attachEvent","removeEventListener","detachEvent","set","load"],"mappings":"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","file":"../../modules/lazyload.min.js","sourcesContent":["// -----------------------------------\r\n// Lazy Load (配合Object-fit)\r\n// -----------------------------------\r\n// Reference: https://www.robinosborne.co.uk/2016/05/16/lazy-loading-images-dont-rely-on-javascript/\r\n/*\r\n\t* HTML Example\r\n\t[Img]\r\n<img src=\"images/1x1.gif\" class=\"lazy\" data-src=\"real-image.jpg\" alt=\"Photo Description\" />\r\n<noscript>\r\n\t<img src=\"real-image.jpg\" alt=\"\" />\r\n</noscript>\r\n\r\n\t[View more Button]\r\n\t<a href=\"javascript:;\" data-viewmore></a>\r\n\r\n\t[於其它檔案上重新啟動]\r\n\t- 適用於AJAX讀入新物件時重新啟動\r\n\tdocument.querySelector('body').setLazy();\r\n\r\n*/\r\n;(function (window, document) {\r\n\r\n\t// -----------------------------------\r\n\t// Setting\r\n\t// -----------------------------------\r\n\t// 判斷browser Begin\r\n\tvar ua = navigator.userAgent;\r\n\tvar browser = {\r\n\t\tisChrome: /chrome/i.test(ua),\r\n\t\tisFirefox: /firefox/i.test(ua),\r\n\t\tisSafari: /safari/i.test(ua),\r\n\r\n\t\t// https://msdn.microsoft.com/en-us/library/ms537503(v=vs.85).aspx\r\n\t\tisIE: /msie/i.test(ua) || /trident/i.test(ua),\r\n\t\tisEdge: /edge/i.test(ua)\r\n\t};\r\n\t// 修正數值browser\r\n\tif (browser.isChrome) browser.isSafari = false;\r\n\tif (browser.isEdge) {\r\n\t\tbrowser.isChrome = false;\r\n\t\tbrowser.isSafari = false;\r\n\t}\r\n\r\n\t// -----------------------------------\r\n\t// Lazy load Start\r\n\t// -----------------------------------\r\n\twindow.lazy = {};\r\n\r\n\tvar lazyLoad_throttle = throttle(lazyLoad, 500, 1000); // 節流作用\r\n\r\n\tregisterListener('load', setLazy);\r\n\tregisterListener('scroll', lazyLoad_throttle);\r\n\tregisterListener('resize', lazyLoad);\r\n\r\n\t// 綁定Scroll\r\n\tfunction scrollLazy() {\r\n\t\tvar lazyScrollWarapper = document.querySelectorAll('[data-lazy-scroll]');\r\n\t\tfor (var k = 0; k < lazyScrollWarapper.length; k++) {\r\n\t\t\tregisterListener('scroll', lazyLoad_throttle, lazyScrollWarapper[k])\r\n\t\t}\r\n\t}\r\n\tregisterListener('load', scrollLazy);\r\n\twindow.lazy.scrollBind = scrollLazy;\r\n\r\n\r\n\tvar lazy = [];\r\n\tvar lazyClass = 'lazy';\r\n\tvar lazyAttr = 'data-src';\r\n\tvar lazyAttrBg = 'data-background'; // 配合Swiper\r\n\tvar lazyCssOnly = 'lazy-css' // 只增加 CSS 不增加圖片\r\n\tvar lazyloadedClass = 'loaded';\r\n\tvar lazyloadedClass_wrapper = 'loaded-content';\r\n\tvar pageReady = false;\r\n\r\n\tvar objectFitClass = 'object-fit';\r\n\tvar objectFitClassContain = 'object-fit-contain';\r\n\r\n\tvar viewmoreButton;\r\n\r\n\tvar registerScroll = true;\t// 確認是否關閉 => 可再開啟\r\n\r\n\tfunction setLazy() {\r\n\t\tlazy = document.getElementsByClassName(lazyClass);\r\n\t\tpageReady = true;\r\n\t\tif(lazy.length > 0 && !registerScroll){\r\n\t\t\tregisterScroll = true;\r\n\t\t\tregisterListener('scroll', lazyLoad_throttle);\r\n\t\t}\r\n\t\tlazyLoad();\r\n\r\n\t\t// View More button\r\n\t\tviewmoreButton = document.querySelector('[data-loadmore]');\r\n\t\tif (viewmoreButton != null) {\r\n\t\t\tviewmoreButton.onclick = function () {\r\n\t\t\t\tlazyLoad();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t// Add Window property\r\n\twindow.lazy.set = setLazy;\r\n\r\n\tfunction lazyLoad() {\r\n\t\tif (!pageReady) return false;\r\n\r\n\t\tfor (var i = 0; i < lazy.length; i++) {\r\n\t\t\tif (isInViewport(lazy[i])) {\r\n\t\t\t\tvar currentLazyEl = lazy[i];\r\n\r\n\t\t\t\tif (currentLazyEl.classList.contains(lazyCssOnly)) {\r\n\t\t\t\t\t// Add Class Only\r\n\t\t\t\t\tcurrentLazyEl.classList.add(lazyloadedClass);\r\n\t\t\t\t\tcurrentLazyEl.parentElement.classList.add(lazyloadedClass_wrapper);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar lazyImg = currentLazyEl.getAttribute(lazyAttr);\r\n\t\t\t\t\tvar lazyBg = currentLazyEl.getAttribute(lazyAttrBg); // 配合Swiper\r\n\t\t\t\t\tvar imgSrc = lazyImg || lazyBg;\r\n\t\t\t\t\tvar isBg = currentLazyEl.tagName.toUpperCase() !== 'IMG';\r\n\t\t\t\t\tif (imgSrc !== null && imgSrc !== undefined) {\r\n\r\n\t\t\t\t\t\tif (browser.isIE && (currentLazyEl.parentElement.classList.contains(objectFitClass) || currentLazyEl.parentElement.classList.contains(objectFitClassContain))) {\r\n\t\t\t\t\t\t\t// Is IE & Is Object-fit\r\n\t\t\t\t\t\t\tcurrentLazyEl.style.backgroundImage = \"url(\" + imgSrc + \")\";\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif (isBg) {\r\n\t\t\t\t\t\t\t\tcurrentLazyEl.style.backgroundImage = \"url(\" + imgSrc + \")\";\r\n\t\t\t\t\t\t\t} else if (lazyImg) {\r\n\t\t\t\t\t\t\t\tcurrentLazyEl.src = imgSrc;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t// remove the attribute\r\n\t\t\t\t\t\tcurrentLazyEl.removeAttribute(lazyAttr);\r\n\t\t\t\t\t\tcurrentLazyEl.removeAttribute(lazyAttrBg);\r\n\r\n\t\t\t\t\t\t// Loaded\r\n\t\t\t\t\t\tif (isBg) {\r\n\t\t\t\t\t\t\tcurrentLazyEl.classList.add(lazyloadedClass);\r\n\t\t\t\t\t\t\tcurrentLazyEl.parentElement.classList.add(lazyloadedClass_wrapper);\r\n\t\t\t\t\t\t} else if (lazyImg) {\r\n\t\t\t\t\t\t\tcurrentLazyEl.onload = function () {\r\n\t\t\t\t\t\t\t\tvar _this = this;\r\n\t\t\t\t\t\t\t\tvar _thisParent = _this.parentElement;\r\n\t\t\t\t\t\t\t\t_this.classList.add(lazyloadedClass);\r\n\t\t\t\t\t\t\t\t_thisParent.classList.add(lazyloadedClass_wrapper);\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t// Loader Img (with Swiper)\r\n\t\t\t\t\t\t\t\tvar _thisLoader = _thisParent.querySelector('.swiper-lazy-preloader');\r\n\t\t\t\t\t\t\t\t_thisLoader && _thisLoader.remove();\r\n\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t\t// Fixed IE\r\n\t\t\t\t\t\t\tif (currentLazyEl.complete) {\r\n\t\t\t\t\t\t\t\tcurrentLazyEl.classList.add(lazyloadedClass);\r\n\t\t\t\t\t\t\t\tcurrentLazyEl.parentElement.classList.add(lazyloadedClass_wrapper);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tcleanLazy();\r\n\r\n\t\t// If load all of the item, stop Listener\r\n\t\tif (lazy.length === 0) {\r\n\t\t\tregisterScroll = false;\r\n\t\t\tremoveListener('scroll', lazyLoad_throttle);\r\n\t\t\tremoveListener('resize', lazyLoad);\r\n\t\t}\r\n\t}\r\n\r\n\t// Add Window property\r\n\twindow.lazy.load = lazyLoad;\r\n\r\n\tfunction isInViewport(el) {\r\n\t\tvar rect = el.getBoundingClientRect();\r\n\r\n\t\treturn (\r\n\t\t\trect.width > 0 &&\r\n\t\t\trect.height > 0 &&\r\n\r\n\t\t\trect.bottom >= 0 &&\r\n\t\t\trect.right >= 0 &&\r\n\r\n\t\t\trect.top <= (window.innerHeight || document.documentElement.clientHeight) &&\r\n\t\t\trect.left <= (window.innerWidth || document.documentElement.clientWidth)\r\n\t\t);\r\n\t}\r\n\r\n\tfunction cleanLazy() {\r\n\t\tlazy = Array.prototype.filter.call(lazy, function (l) {\r\n\t\t\treturn (!l.classList.contains(lazyloadedClass));\r\n\t\t});\r\n\t}\r\n\r\n\tfunction registerListener(event, func, target) {\r\n\t\tvar tg = (target != undefined) ? target : window;\r\n\t\tif (window.addEventListener) {\r\n\t\t\ttg.addEventListener(event, func, false)\r\n\t\t} else {\r\n\t\t\ttg.attachEvent('on' + event, func)\r\n\t\t}\r\n\t}\r\n\r\n\tfunction removeListener(event, func, target) {\r\n\t\tvar tg = (target != undefined) ? target : window;\r\n\t\tif (window.addEventListener) {\r\n\t\t\ttg.removeEventListener(event, func, false)\r\n\t\t} else {\r\n\t\t\ttg.detachEvent('on' + event, func)\r\n\t\t}\r\n\t}\r\n\r\n\t// https://www.cnblogs.com/coco1s/p/5499469.html\r\n\t// 簡單的節流函數\r\n\tfunction throttle(func, wait, mustRun) {\r\n\t\tvar timeout,\r\n\t\t\tstartTime = new Date();\r\n\r\n\t\treturn function () {\r\n\t\t\tvar context = this,\r\n\t\t\t\targs = arguments,\r\n\t\t\t\tcurTime = new Date();\r\n\r\n\t\t\tif (timeout != undefined){\r\n\t\t\t\tif(window.requestTimeout != undefined){\r\n\t\t\t\t\tclearRequestTimeout(timeout)\r\n\t\t\t\t}else{\r\n\t\t\t\t\tclearTimeout(timeout);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\t// 如果達到了規定的觸發時間間隔，觸發 handler\r\n\t\t\tif (curTime - startTime >= mustRun) {\r\n\t\t\t\tfunc.apply(context, args);\r\n\t\t\t\tstartTime = curTime;\r\n\t\t\t\t// 沒達到觸發間隔，重新設定定時器\r\n\t\t\t} else {\r\n\t\t\t\tif(window.requestTimeout != undefined){\r\n\t\t\t\t\ttimeout = requestTimeout(func, wait);\r\n\t\t\t\t}else{\r\n\t\t\t\t\ttimeout = setTimeout(func, wait);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n\r\n})(window, document);\r\n"],"sourceRoot":"../../../src/"}